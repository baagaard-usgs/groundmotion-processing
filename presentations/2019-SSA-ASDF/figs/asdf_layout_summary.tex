\documentclass[tikz, border=2pt]{standalone}
\usepackage[none]{hyphenat}
\usepackage{helvet}
\renewcommand{\familydefault}{phv}

\begin{document}
\pagestyle{empty}

\input{palettes/palette_general}
\input{palettes/palette_usgs}

\input{asdf_layout_base}

\begin{tikzpicture}[diagram]

  \node (workspace) [root] {Root (Workspace)};

  % Events
  \node (events) [below=of workspace.center, dataset, xml, subset-right] {QuakeML};
  \draw[arrowto] (workspace.south) |- (events.west);

  % Waveforms
  \node (waveforms) [below=of events.west, group] {Waveforms};
  \draw[arrowto] (workspace.south) |- (waveforms.west);

  \node (wf-st0) [below=of waveforms.center, group, subset-right] {\variable{NET.STA}};
  \node (st0-metadata) [below=of wf-st0.center, dataset, xml, subset-right] {StationXML};
  \node (wf-st0-data0) [below=of st0-metadata.west, dataset] {\variable{NET.STA.LOC.CHA\duscore{}START\duscore{}END\duscore{}TAG}};
  \node (wf-st0-data1) [below=of wf-st0-data0.west, dataset] {\variable{NET.STA.LOC.CHA\duscore{}START\duscore{}END\duscore{}TAG}};
  \draw[arrowto] (waveforms.south) |- (wf-st0.west);
  \draw[arrowto] (wf-st0.south) |- (st0-metadata.west);
  \draw[arrowto] (wf-st0.south) |- (wf-st0-data0.west);
  \draw[arrowto] (wf-st0.south) |- (wf-st0-data1.west);
  
  \node (wf-st1) [below=of wf-st0.west, group, yshift=-7.5em] {\variable{NET.STA}};
  \node (st1-metadata) [below=of wf-st1.center, dataset, xml, subset-right] {StationXML};
  \node (wf-st1-data0) [below=of st1-metadata.west, dataset] {\variable{NET.STA.LOC.CHA\duscore{}START\duscore{}END\duscore{}TAG}};
  \draw[arrowto] (waveforms.south) |- (wf-st1.west);
  \draw[arrowto] (wf-st1.south) |- (st1-metadata.west);
  \draw[arrowto] (wf-st1.south) |- (wf-st1-data0.west);

  % Auxiliary data
  \node (auxdata) [below=of waveforms.west, group, yshift=-18em] {AuxiliaryData};
  \draw[arrowto] (workspace.south) |- (auxdata.west);

  % Provenance
  \node (provenance) [below=of auxdata.west, group, yshift=-0em] {Provenance};
  \node (prov0) [below=of provenance.center, dataset, xml, subset-right] {\variable{SEIS-PROV XML}};
  \node (prov1) [below=of prov0.west, dataset, xml] {]variable{SEIS-PROV XML}};
  \node (prov2) [below=of prov1.west, dataset, xml] {]variable{SEIS-PROV XML}};
  \draw[arrowto] (workspace.south) |- (provenance.west);
  \draw[arrowto] (provenance.south) |- (prov0.west);
  \draw[arrowto] (provenance.south) |- (prov1.west);
  \draw[arrowto] (provenance.south) |- (prov2.west);

  % Legend
  \matrix [draw=white,below left, row sep=0.5em] at (current bounding box.north east) {
    \node [group, legend] {Group}; \\[4pt]
    \node [dataset, legend] {Dataset as int/float array}; \\
    \node [dataset, xml, legend] {Dataset as XML}; \\
  };
  
\end{tikzpicture}

\end{document}

